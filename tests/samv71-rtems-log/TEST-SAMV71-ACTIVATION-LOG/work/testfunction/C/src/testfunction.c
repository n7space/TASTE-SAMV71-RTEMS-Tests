/* Body file for function testfunction
 * Generated by TASTE (kazoo/templates/skeletons/c-body/function.tmplt)
 * You can edit this file, it will not be overwritten

    !! IMPORTANT                                                        !!
    !! When you modify your design (interface view), you must update    !!
    !! the procedures corresponding to the provided interfaces in this  !!
    !! file. The up-to-date signatures can be found in the header file. !!
*/
#include "testfunction.h"
#include <Monitor.h>

static bool test_log_result = false;
static bool test_log_clean_result = false;
static bool test_result = false;

void testfunction_startup(void)
{
    Monitor_UnfreezeInterfaceActivationLogging();
}

void testfunction_PI_trigger_freeze( void )
{
    Monitor_FreezeInterfaceActivationLogging();
}

void testfunction_PI_trigger_check(void)
{
    struct Monitor_InterfaceActivationEntry *activation_log;
    uint32_t latest_activation_entry_index;
    uint32_t size_of_activation_log;
    bool query_result = false;

    query_result = Monitor_GetInterfaceActivationEntryLog(&activation_log, &latest_activation_entry_index, &size_of_activation_log);

    if(latest_activation_entry_index == 16 && size_of_activation_log == 17 &&
       activation_log[0].interface == triggerfunction_trigger && activation_log[0].entry_type == Monitor_EntryType_activation &&
       activation_log[0].timestamp > 199000000 && activation_log[0].timestamp < 201000000 &&
       activation_log[1].interface == triggerfunction_trigger && activation_log[1].entry_type == Monitor_EntryType_deactivation &&
       activation_log[1].timestamp > 199000000 && activation_log[1].timestamp < 201000000 && activation_log[1].timestamp > activation_log[0].timestamp &&
       activation_log[2].interface == receiver_sporadic_if && activation_log[2].entry_type == Monitor_EntryType_activation &&
       activation_log[2].timestamp > 199000000 && activation_log[2].timestamp < 201000000 && activation_log[2].timestamp > activation_log[1].timestamp &&
       activation_log[3].interface == receiver_sporadic_if && activation_log[3].entry_type == Monitor_EntryType_deactivation &&
       activation_log[3].timestamp > 199000000 && activation_log[3].timestamp < 201000000 && activation_log[3].timestamp > activation_log[2].timestamp &&
       activation_log[4].interface == receiver_cyclic_if && activation_log[4].entry_type == Monitor_EntryType_activation &&
       activation_log[4].timestamp > 299000000 && activation_log[4].timestamp < 301000000 && activation_log[4].timestamp > activation_log[3].timestamp &&
       activation_log[5].interface == receiver_cyclic_if && activation_log[5].entry_type == Monitor_EntryType_deactivation &&
       activation_log[5].timestamp > 299000000 && activation_log[5].timestamp < 301000000 && activation_log[5].timestamp > activation_log[4].timestamp &&
       activation_log[6].interface == triggerfunction_trigger && activation_log[6].entry_type == Monitor_EntryType_activation &&
       activation_log[6].timestamp > 399000000 && activation_log[6].timestamp < 401000000 &&
       activation_log[16].interface == testfunction_trigger_freeze && activation_log[16].entry_type == Monitor_EntryType_activation &&
       activation_log[16].timestamp > 699000000 && activation_log[16].timestamp < 701000000)
    {
        test_log_result = true;
    }

    query_result = query_result && Monitor_ClearInterfaceActivationLog();
    query_result = query_result && Monitor_GetInterfaceActivationEntryLog(&activation_log, &latest_activation_entry_index, &size_of_activation_log);

    if(latest_activation_entry_index == 0 && size_of_activation_log == 0)
    {
        test_log_clean_result = true;
    }

    test_result = test_log_result && test_log_clean_result && query_result;
}


